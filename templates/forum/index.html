{% extends 'base.html' %}

{% block title %}åˆ›ä¸šæˆé•¿è®ºå›{% endblock %}

{% block content %}
<!-- Welcome Hero Section -->
<div class="row mb-5">
    <div class="col-12">
        <div class="card border-0" style="background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%); color: white;">
            <div class="card-body py-4">
                <div class="d-flex justify-content-between align-items-center">
                    <div>
                        <h1 class="h3 mb-2 text-white">ğŸš€ æ¬¢è¿æ¥åˆ°åˆ›ä¸šæˆé•¿è®ºå›</h1>
                        <p class="mb-0 opacity-90">ä¸åˆ›ä¸šè€…ä¸€èµ·åˆ†äº«ç»éªŒã€äº¤æµæƒ³æ³•ã€å…±åŒæˆé•¿</p>
                    </div>
                    {% if user.is_authenticated %}
                        <a href="{% url 'forum:select_category' %}" class="btn btn-light fw-bold">
                            <i class="bi bi-plus-circle"></i> å‘è¡¨æ–°ä¸»é¢˜
                        </a>
                    {% else %}
                        <a href="{% url 'accounts:login' %}" class="btn btn-light fw-bold">
                            <i class="bi bi-box-arrow-in-right"></i> ç™»å½•å‚ä¸è®¨è®º
                        </a>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Content Header -->
<div class="row mb-4">
    <div class="col-12">
        <h2 class="h4 mb-0">ğŸ”¥ æœ€æ–°è®¨è®º</h2>
    </div>
</div>

<!-- Main Topics Feed -->
<div class="row">
    <div class="col-12">
        <!-- Filter Tabs -->
        <ul class="nav nav-tabs mb-4" id="topicTabs" role="tablist">
            <li class="nav-item" role="presentation">
                <button class="nav-link active" id="latest-tab" data-bs-toggle="tab" data-bs-target="#latest" type="button" role="tab">
                    <i class="bi bi-clock"></i> æœ€æ–°
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="trending-tab" data-bs-toggle="tab" data-bs-target="#trending" type="button" role="tab">
                    <i class="bi bi-fire"></i> çƒ­é—¨
                </button>
            </li>
        </ul>

        <!-- Tab Content -->
        <div class="tab-content" id="topicTabsContent">
            <!-- Latest Topics -->
            <div class="tab-pane fade show active" id="latest" role="tabpanel">
                {% for topic in recent_topics %}
                    <div class="card mb-3 border-0 shadow-sm">
                        <div class="card-body p-3">
                            <div class="d-flex justify-content-between align-items-start mb-2">
                                <h6 class="mb-0">
                                    {% if topic.is_pinned %}
                                        <i class="bi bi-pin-fill text-warning me-1"></i>
                                    {% endif %}
                                    <a href="{% url 'forum:topic_detail' topic.slug %}" class="text-decoration-none text-dark">
                                        {{ topic.title }}
                                    </a>
                                </h6>
                                <span class="badge bg-light text-dark small">{{ topic.category.name }}</span>
                            </div>
                            <p class="text-muted mb-2 small">{{ topic.content|truncatewords:20 }}</p>
                            <div class="d-flex justify-content-between align-items-center small text-muted">
                                <div>
                                    <i class="bi bi-person me-1"></i>{{ topic.author.username }}
                                    <span class="ms-2"><i class="bi bi-clock me-1"></i>{{ topic.created_at|timesince }}å‰</span>
                                </div>
                                <div class="d-flex align-items-center">
                                    <span class="me-2">
                                        <i class="bi bi-chat-dots me-1"></i>{{ topic.reply_count }}
                                        <span class="ms-2"><i class="bi bi-eye me-1"></i>{{ topic.views }}</span>
                                    </span>
                                    {% if user.is_authenticated and user == topic.author or user.is_staff %}
                                        <a href="{% url 'forum:delete_topic' topic.slug %}" class="btn btn-sm btn-outline-danger ms-2" title="åˆ é™¤ä¸»é¢˜">
                                            <i class="bi bi-trash"></i>
                                        </a>
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                    </div>
                {% empty %}
                    <div class="card border-0 text-center py-5" style="background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);">
                        <div class="card-body">
                            <div class="mb-4">
                                <i class="bi bi-chat-square-dots" style="font-size: 4rem; color: var(--text-secondary);"></i>
                            </div>
                            <h4 class="mb-3" style="color: var(--text-primary);">ğŸš€ è¿˜æ²¡æœ‰è®¨è®ºå†…å®¹</h4>
                            <p class="text-muted mb-4">æˆä¸ºç¬¬ä¸€ä¸ªåˆ†äº«åˆ›ä¸šç»éªŒçš„äººå§ï¼</p>
                            {% if user.is_authenticated %}
                                <a href="{% url 'forum:select_category' %}" class="btn btn-primary btn-lg fw-bold">
                                    <i class="bi bi-plus-circle"></i> å¼€å§‹å‘è¡¨ä¸»é¢˜
                                </a>
                            {% else %}
                                <a href="{% url 'accounts:register' %}" class="btn btn-primary btn-lg fw-bold">
                                    <i class="bi bi-person-plus"></i> æ³¨å†Œå¹¶å¼€å§‹è®¨è®º
                                </a>
                            {% endif %}
                        </div>
                    </div>
                {% endfor %}
            </div>

            <!-- Trending Topics -->
            <div class="tab-pane fade" id="trending" role="tabpanel">
                {% for topic in trending_topics %}
                    <div class="card mb-3 border-0 shadow-sm">
                        <div class="card-body p-3">
                            <div class="d-flex justify-content-between align-items-start mb-2">
                                <h6 class="mb-0">
                                    {% if topic.is_pinned %}
                                        <i class="bi bi-pin-fill text-warning me-1"></i>
                                    {% endif %}
                                    <i class="bi bi-fire text-danger me-1"></i>
                                    <a href="{% url 'forum:topic_detail' topic.slug %}" class="text-decoration-none text-dark">
                                        {{ topic.title }}
                                    </a>
                                </h6>
                                <span class="badge bg-light text-dark small">{{ topic.category.name }}</span>
                            </div>
                            <p class="text-muted mb-2 small">{{ topic.content|truncatewords:20 }}</p>
                            <div class="d-flex justify-content-between align-items-center small text-muted">
                                <div>
                                    <i class="bi bi-person me-1"></i>{{ topic.author.username }}
                                    <span class="ms-2"><i class="bi bi-clock me-1"></i>{{ topic.created_at|timesince }}å‰</span>
                                </div>
                                <div>
                                    <i class="bi bi-chat-dots me-1"></i>{{ topic.reply_count }}
                                    <span class="ms-2"><i class="bi bi-eye me-1"></i>{{ topic.views }}</span>
                                    <span class="ms-2 text-danger"><i class="bi bi-fire me-1"></i>çƒ­åº¦{{ topic.popularity_score|default:0 }}</span>
                                </div>
                            </div>
                        </div>
                    </div>
                {% empty %}
                    <div class="card border-0 text-center py-5" style="background: linear-gradient(135deg, #fff5f5 0%, #fed7d7 100%);">
                        <div class="card-body">
                            <div class="mb-4">
                                <i class="bi bi-fire" style="font-size: 4rem; color: #e53e3e;"></i>
                            </div>
                            <h4 class="mb-3" style="color: var(--text-primary);">ğŸ”¥ è¿˜æ²¡æœ‰çƒ­é—¨å†…å®¹</h4>
                            <p class="text-muted mb-4">å¤šäº’åŠ¨ã€å¤šæµè§ˆï¼Œè®©ä¼˜è´¨å†…å®¹æˆä¸ºçƒ­é—¨ï¼</p>
                        </div>
                    </div>
                {% endfor %}
            </div>
        </div>
    </div>
</div>


{% endblock %}
